require("../../config/config").config("ih");
const { addCatToProduct } = require("../../functions/products/addCatToProduct");
/**
 * issue with this script is that its prematurely returning an empty array and not the expected output from promise allsettled
 */
const productIds = [{"ih id":849},
{"ih id":3189},
{"ih id":1146},
{"ih id":1145},
{"ih id":1149},
{"ih id":919},
{"ih id":3688},
{"ih id":540},
{"ih id":4023},
{"ih id":4022},
{"ih id":2824},
{"ih id":1148},
{"ih id":2698},
{"ih id":3125},
{"ih id":3533},
{"ih id":2938},
{"ih id":3518},
{"ih id":1017},
{"ih id":1015},
{"ih id":1024},
{"ih id":1147},
{"ih id":919},
{"ih id":3683},
{"ih id":2925},
{"ih id":3689},
{"ih id":894},
{"ih id":2909},
{"ih id":3750},
{"ih id":3755},
{"ih id":3754},
{"ih id":989},
{"ih id":986},
{"ih id":953},
{"ih id":943},
{"ih id":698},
{"ih id":692},
{"ih id":3238},
{"ih id":3482},
{"ih id":942},
{"ih id":927},
{"ih id":2575},
{"ih id":2997},
{"ih id":4025},
{"ih id":1147},
{"ih id":2675},
{"ih id":1143},
{"ih id":1144},
{"ih id":937},
{"ih id":3715},
{"ih id":2642},
{"ih id":2746},
{"ih id":3516},
{"ih id":2758},
{"ih id":1019},
{"ih id":3308},
{"ih id":3620},
{"ih id":980},
{"ih id":983},
{"ih id":3306},
{"ih id":697},
{"ih id":688},
{"ih id":2772},
{"ih id":3626},
{"ih id":2724},
{"ih id":3812},
{"ih id":2574},
{"ih id":874},
{"ih id":2394},
{"ih id":3593},
{"ih id":897},
{"ih id":981},
{"ih id":3304},
{"ih id":4027},
{"ih id":3316},
{"ih id":3056},
{"ih id":2417},
{"ih id":3602},
{"ih id":2440},
{"ih id":3824},
{"ih id":3677},
{"ih id":3341},
{"ih id":3544},
{"ih id":985},
{"ih id":3313},
{"ih id":2793},
{"ih id":2940},
{"ih id":825},
{"ih id":3243},
{"ih id":2721},
{"ih id":826},
{"ih id":827},
{"ih id":3305},
{"ih id":4026},
{"ih id":3314},
{"ih id":907},
{"ih id":991},
{"ih id":810},
{"ih id":3691},
{"ih id":2828},
{"ih id":3586},
{"ih id":824},
{"ih id":3364},
{"ih id":3190},
{"ih id":959},
{"ih id":3343},
{"ih id":568},
{"ih id":3241},
{"ih id":828},
{"ih id":2496},
{"ih id":570},
{"ih id":570},
{"ih id":3354},
{"ih id":906},
{"ih id":3334},
{"ih id":2411},
{"ih id":3468},
{"ih id":958},
{"ih id":3995},
{"ih id":3785},
{"ih id":3366},
{"ih id":960},
{"ih id":3356},
{"ih id":3789},
{"ih id":3783},
{"ih id":3514},
{"ih id":3786},
{"ih id":885},
{"ih id":3514},
{"ih id":886},
{"ih id":887},
{"ih id":3788},
{"ih id":3190},
{"ih id":3064},
{"ih id":3342},
{"ih id":2588},
{"ih id":2919},
{"ih id":2971},
{"ih id":2662},
{"ih id":2662},
{"ih id":2820}]
// alfaparf products with shampoo mentioned in cat field

let catId = 1485; 
/**
 * This needs to be tested before using
 * @param {object[]} productIds
 * @param {number} categoryId
 * @returns
 */
const addCategoryToSpecificProducts = (productIds, categoryId) =>
  new Promise((resolve, reject) => {
    if (!Array.isArray(productIds) || typeof categoryId !== "number")
      return reject("please check paramters");
    let promises = [];
    productIds.forEach((productId) => {
      let id = productId[Object.keys(productId)[0]];
      if (typeof id !== "number") return reject("product id must be a number");
      promises.push(addCatToProduct(id, categoryId));
    });
    Promise.allSettled(promises).then(resolve).catch(reject);
  });

addCategoryToSpecificProducts(productIds, catId)
  .then((res) => console.log("addCategoryToSpecificProducts response", res))
  .catch(console.log);
